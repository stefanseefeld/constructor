

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Special Topics - Faber 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.0',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Faber 1.0 documentation" href="../index.html" />
    <link rel="up" title="Faber Tutorial" href="index.html" />
    <link rel="next" title="Faber Reference" href="../reference/index.html" />
    <link rel="prev" title="Advanced concepts" href="advanced_concepts.html" /> 
  </head>
  <body>
    <div class="header">
    <table border="0" cellpadding="7" cellspacing="0" width="100%" summary=
    "header">
      <tr>
        <td valign="top" width="300">
          <h3><a href="../index.html"><img 
          alt="C++ Boost" src="../_static/logo.png" border="0"></a></h3>
        </td>
	<td>
      <div id="searchbox" style="display: none">
        <form class="search" action="../search.html" method="get">
          <input type="text" name="q" size="18" />
          <input type="submit" value="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
      </div>
      <script type="text/javascript">$('#searchbox').show(0);</script>
	</td>
      </tr>
    </table>
    </div>
    <hr/>
    <div class="content">
    <div class="navbar" style="text-align:right;">
      
      
      <a class="prev" title="Advanced concepts" href="advanced_concepts.html"><img src="../_static/prev.png" alt="prev"/></a>
      <a class="up" title="Faber Tutorial" href="index.html"><img src="../_static/up.png" alt="up"/></a>
      <a class="next" title="Faber Reference" href="../reference/index.html"><img src="../_static/next.png" alt="next"/></a>
      
    </div>
      
  <div class="section" id="special-topics">
<h1>Special Topics</h1>
<div class="section" id="configuring-builds">
<h2>Configuring Builds</h2>
<p>The build logic of a project may depend on features of the build platform that
isn't known in advance. The user (who does the build) may wish to provide some
parameters (such as prerequisite library paths), or check whether the compiler
supports the latest language features.</p>
<p>The <cite>faber.config</cite> subpackage provides facilities to perform such checks (akin
to those in the <cite>GNU autoconf tool</cite>). They define conditional features that
can be set either globally or for specific artefacts. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faber.config</span> <span class="kn">import</span> <span class="n">cxx_checks</span><span class="p">,</span> <span class="n">report</span>

<span class="n">checks</span> <span class="o">=</span> <span class="p">[</span><span class="n">cxx_checks</span><span class="o">.</span><span class="n">has_cxx11</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">define</span><span class="p">(</span><span class="s1">&#39;HAS_CXX11&#39;</span><span class="p">)),</span>
          <span class="n">cxx_checks</span><span class="o">.</span><span class="n">has_cxx14</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">define</span><span class="p">(</span><span class="s1">&#39;HAS_CXX14&#39;</span><span class="p">)),</span>
          <span class="n">cxx_checks</span><span class="o">.</span><span class="n">has_cxx17</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">define</span><span class="p">(</span><span class="s1">&#39;HAS_CXX17&#39;</span><span class="p">))]</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">report</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="n">checks</span><span class="p">)</span>
<span class="n">check</span> <span class="o">=</span> <span class="n">binary</span><span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="s1">&#39;main.cpp&#39;</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">use</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The <cite>check</cite> binary gets its features from the <cite>config</cite> report, which performs
a set of checks, and then defines macros corresponding to the compiler features
that are detected. Injecting these features implies a dependency, so whenever
<cite>check</cite> needs to be built, the associated config checks will be done first.
(Faber provides some caching mechanism so these checks don't have to be re-run
if their values are already known.)</p>
</div>
<div class="section" id="running-tests">
<h2>Running Tests</h2>
<p>An important part of building software is testing. Code that has not been tested
adequately generally does not work. As test execution is often intimately tied to
the construction of the tested code, it is natural to integrate the relevant logic
into the construction tool itself.</p>
<p>Consider this fabscript snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faber.artefacts.binary</span> <span class="kn">import</span> <span class="n">binary</span>
<span class="kn">from</span> <span class="nn">faber.test</span> <span class="kn">import</span> <span class="n">test</span><span class="p">,</span> <span class="n">report</span><span class="p">,</span> <span class="n">fail</span>

<span class="n">passing</span> <span class="o">=</span> <span class="n">binary</span><span class="p">(</span><span class="s1">&#39;passing&#39;</span><span class="p">,</span> <span class="s1">&#39;passing.cpp&#39;</span><span class="p">)</span>
<span class="n">failing</span> <span class="o">=</span> <span class="n">binary</span><span class="p">(</span><span class="s1">&#39;failing&#39;</span><span class="p">,</span> <span class="s1">&#39;failing.cpp&#39;</span><span class="p">)</span>

<span class="n">test1</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="s1">&#39;test1&#39;</span><span class="p">,</span> <span class="n">passing</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="s1">&#39;test2&#39;</span><span class="p">,</span> <span class="n">failing</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test3</span> <span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="s1">&#39;test3&#39;</span><span class="p">,</span> <span class="n">failing</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="n">fail</span><span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
<p>The above defines three tests consisting in running test binaries. For the sake
of example, let us assume that one of the binaries is passing and one is failing.
the <cite>test3</cite> above takes an optional argument to indicate that the test is expected
to fail.</p>
<p>While it is of course possible to run the tests explicitly from the command line
(using <cite>faber ... test1 test2 test3</cite>), it is much more useful to run them using
the built-in report mechanism. In addition to executing the selected tests this
may produce a test summary, or even a more elaborate test report:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;test-report&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">test1</span><span class="p">,</span> <span class="n">test2</span><span class="p">,</span> <span class="n">test3</span><span class="p">])</span>
</pre></div>
</div>
<p>Invoking <cite>faber test-report</cite> will now generate output such as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>test1: PASS
test2: FAIL
test3: XFAIL
test summary: 1 pass, 1 failure, 1 expected failure
</pre></div>
</div>
</div>
</div>


    <div class="navbar" style="text-align:right;">
      
      
      <a class="prev" title="Advanced concepts" href="advanced_concepts.html"><img src="../_static/prev.png" alt="prev"/></a>
      <a class="up" title="Faber Tutorial" href="index.html"><img src="../_static/up.png" alt="up"/></a>
      <a class="next" title="Faber Reference" href="../reference/index.html"><img src="../_static/next.png" alt="next"/></a>
      
    </div>
    </div>
    <div class="footer">
      <p>last updated Jan 02, 2021</p>
    </div>
  </body>
</html>